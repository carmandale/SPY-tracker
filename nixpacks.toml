[phases.setup]
dependsOn = ['install']

[phases.install]
cmds = [
    'echo "ğŸ—ï¸ Building SPY TA Tracker for deployment..."',
    'echo "ğŸ“¦ Installing frontend dependencies..."',
    'yarn install --frozen-lockfile',
    'echo "ğŸ”¨ Building frontend..."',
    'yarn build',
    'echo "ğŸ“ Copying frontend build to backend..."',
    'mkdir -p backend/static',
    'cp -r dist/* backend/static/',
    'echo "ğŸ Installing backend dependencies..."',
    'cd backend && uv pip install --system -r pyproject.toml',
    'mkdir -p backend/data',
    'echo "âœ… Build complete! Ready for deployment."'
]

[phases.build]
cmds = ['echo "Build phase completed"']

[start]
cmd = 'cd backend && uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT'

[variables]
NIXPACKS_PYTHON_VERSION = '3.11'