[phases.setup]
dependsOn = ['install']

[phases.install]
cmds = [
    'echo "🏗️ Building SPY TA Tracker for deployment..."',
    'echo "📦 Installing frontend dependencies..."',
    'yarn install --frozen-lockfile',
    'echo "🔨 Building frontend with production environment..."',
    'echo "VITE_API_URL=${VITE_API_URL}" > .env.production.local',
    'cat .env.production.local',
    'yarn build',
    'echo "📁 Copying frontend build to backend..."',
    'mkdir -p backend/static',
    'cp -r dist/* backend/static/',
    'echo "🐍 Installing backend dependencies..."',
    'cd backend && uv pip install --system -r pyproject.toml',
    'mkdir -p backend/data',
    'echo "✅ Build complete! Ready for deployment."'
]

[phases.build]
cmds = ['echo "Build phase completed"']

[start]
cmd = 'cd backend && uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT'

[variables]
NIXPACKS_PYTHON_VERSION = '3.11'