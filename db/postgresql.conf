# PostgreSQL Configuration for SPY TA Tracker Development
# Optimized for development environment with moderate performance needs

# Memory configuration
shared_buffers = 256MB              # 25% of available memory for small dev env
effective_cache_size = 1GB          # Available system cache
work_mem = 4MB                      # Memory for sort operations
maintenance_work_mem = 64MB         # Memory for maintenance operations

# Connection settings
max_connections = 50                # Sufficient for development
listen_addresses = '*'              # Accept connections from any address

# Performance settings
random_page_cost = 1.1             # SSD-optimized
effective_io_concurrency = 200     # Concurrent I/O operations for SSD

# WAL (Write-Ahead Logging) settings
wal_buffers = 16MB                 # WAL buffer size
checkpoint_completion_target = 0.7  # Smooth checkpoint completion
checkpoint_timeout = 10min         # Checkpoint frequency

# Query planning
default_statistics_target = 100    # Statistics detail level

# Logging configuration for development
log_destination = 'stderr'
logging_collector = off
log_min_messages = notice
log_min_error_statement = error
log_min_duration_statement = 100   # Log queries taking > 100ms
log_statement = 'all'              # Log all statements for debugging
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Autovacuum settings
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min

# Locale settings
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'

# Default configuration from here down
default_text_search_config = 'pg_catalog.english'
dynamic_shared_memory_type = posix
shared_preload_libraries = 'pg_stat_statements'

# Enable extensions for monitoring
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all
track_activity_query_size = 1024

# Additional optimizations for time-series data (SPY prices)
# Enable JIT for complex queries (PostgreSQL 11+)
jit = on
jit_above_cost = 100000
jit_inline_above_cost = 500000
jit_optimize_above_cost = 500000